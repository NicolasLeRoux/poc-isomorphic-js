<template id="poc-lazy-img-tmpl">
	<style>
		:host {
			position: relative;
		}

		@keyframes fadein {
			from {
				opacity: 0;
			}
			to {
				opacity: 1	;
			}
		}

		img {
			position: absolute;
			left: 0;
			animation: fadein 1s;
		}
	</style>

	<slot>
	</slot>
</template>

<script>
	class LazyImgElem extends HTMLElement {
		constructor () {
			super();

			const shadowRoot = this.attachShadow({mode: 'open'})
				.appendChild(this.template);
		};

		connectedCallback () {
			var imgSrc = this.getAttribute('src'),
				imgNode = document.createElement('img');

			imgNode.src = imgSrc;
			imgNode.onload = this.onImgLoad.bind(this);
		};

		onImgLoad (event) {
			var imgNode = event.currentTarget;

			this.shadowRoot.appendChild(imgNode);
		};

		get template() {
			if (!this._template) {
				this.constructor.prototype._template = document.currentScript.ownerDocument
					.querySelector('#poc-lazy-img-tmpl').content;
			}

			return this._template.cloneNode(true);
		};
	};

	customElements.define('poc-lazy-img-elem', LazyImgElem);
</script>
